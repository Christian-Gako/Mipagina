<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso - SIMONA | TESCH</title>
    <link rel="stylesheet" href="loginstyle.css">
</head>
<body>
    <div class="login-container">
        <div class="login-card">
            <div class="login-logo">SIMONA</div>
            <h1 class="login-title">Sistema de Monitoreo de Agua</h1>
            <p class="login-subtitle">Tecnol√≥gico de Estudios Superiores de Chalco</p>
            
            <div id="alertMessage" class="alert"></div>
        
            
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="username">Usuario</label>
                    <input type="text" id="username" placeholder="Usuario de acceso" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Contrase√±a</label>
                    <div class="password-container">
                        <input type="password" id="password" placeholder="Contrase√±a" required>
                        <button type="button" class="toggle-password" id="togglePassword" aria-label="Mostrar contrase√±a">
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>
                
                <button type="submit" class="login-btn" id="loginBtn">
                    <span id="btnText">Acceder al Sistema</span>
                    <div id="btnLoader" class="loader" style="display: none;"></div>
                </button>
            </form>
            
            <div class="copyright">
                <p style="font-size: .8em; margin-top: 15px;">
                    Acceso restringido a personal autorizado
                </p>
            </div>
        </div>
    </div>
    <!-- En login.html, DESPU√âS del formulario pero ANTES de los scripts: -->
    <div id="debugInfo" style="
        position: fixed;
        top: 10px;
        right: 10px;
        background: #f8f9fa;
        border: 1px solid #ccc;
        padding: 10px;
        border-radius: 5px;
        font-size: 12px;
        z-index: 9999;
        display: block !important;
    ">
        <strong>DEBUG LOGIN</strong><br>
        <span id="debugPath">Path: </span><br>
        <span id="debugAuth">Autenticado: </span><br>
        <span id="debugScripts">Scripts cargados: </span>
    </div>
    <!-- En login.html, como PRIMER script: -->
<script>
// SCRIPT DE EMERGENCIA - Se ejecuta ANTES que todo
console.log('üö® SCRIPT DE EMERGENCIA EJECUT√ÅNDOSE');

// 1. Verificar si estamos en la p√°gina correcta
const esLoginPage = window.location.pathname === '/' || 
                    window.location.pathname === '' ||
                    window.location.href === window.location.origin ||
                    window.location.href === window.location.origin + '/';

console.log('¬øEs login page?:', esLoginPage);

if (esLoginPage) {
    // 2. Forzar que el body sea visible
    document.body.style.display = 'block';
    document.body.style.visibility = 'visible';
    document.body.style.opacity = '1';
    
    // 3. Mostrar mensaje de carga
    document.body.innerHTML = `
        <div style="
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Arial;
            z-index: 10000;
        ">
            <div style="text-align: center;">
                <h2>Cargando sistema de login...</h2>
                <div id="loadingStatus" style="margin-top: 20px;">
                    Inicializando...
                </div>
            </div>
        </div>
        ${document.body.innerHTML}
    `;
    
    // Actualizar estado
    setTimeout(() => {
        const statusEl = document.getElementById('loadingStatus');
        if (statusEl) statusEl.textContent = 'Cargando scripts...';
    }, 500);
    
    setTimeout(() => {
        const statusEl = document.getElementById('loadingStatus');
        if (statusEl) statusEl.textContent = 'Listo!';
        
        // Remover pantalla de carga despu√©s de 1 segundo
        setTimeout(() => {
            const loader = document.querySelector('div[style*="position: fixed; top: 0"]');
            if (loader) loader.style.display = 'none';
        }, 1000);
    }, 1500);
}
</script>

    <script>
    // DEBUG: Mostrar informaci√≥n inmediatamente
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üîç DEBUG VISUAL: DOM cargado');
        
        // Actualizar info debug
        document.getElementById('debugPath').textContent = 
            'Path: ' + window.location.pathname;
        document.getElementById('debugAuth').textContent = 
            'Autenticado: ' + (sessionStorage.getItem('authToken') ? 'S√ç' : 'NO');
        
        // Contar scripts
        const scripts = document.querySelectorAll('script[src]');
        document.getElementById('debugScripts').textContent = 
            'Scripts: ' + scripts.length;
        
        // Verificar si el formulario existe
        const form = document.getElementById('loginForm');
        console.log('üîç Formulario existe?:', form ? 'S√ç' : 'NO');
        console.log('üîç Formulario visible?:', form && form.offsetParent ? 'S√ç' : 'NO');
        
        // Forzar visibilidad del contenedor
        const container = document.querySelector('.login-container');
        if (container) {
            console.log('üîç Contenedor encontrado');
            container.style.display = 'block';
            container.style.visibility = 'visible';
            container.style.opacity = '1';
        }
    });
    </script>
    <script src="/js/auth-middleware.js"></script>
    <script src="/js/login.js"></script>
    <!-- En login.html, AL FINAL (despu√©s de todos los scripts): -->
<script>
// VERIFICACI√ìN FINAL: ¬øQu√© scripts se ejecutaron?
console.log('üîç VERIFICACI√ìN FINAL DE EJECUCI√ìN:');
console.log('  - AuthMiddleware definido?:', typeof AuthMiddleware !== 'undefined' ? '‚úÖ S√ç' : '‚ùå NO');
console.log('  - SistemaCisterna definido?:', typeof SistemaCisterna !== 'undefined' ? '‚ö†Ô∏è S√ç (ERROR!)' : '‚úÖ NO');
console.log('  - script.js se ejecut√≥?:', window.__SCRIPT_JS_EJECUTADO ? '‚ö†Ô∏è S√ç (ERROR!)' : '‚úÖ NO');

// Si SistemaCisterna SE carg√≥ (error), forzar recarga limpia
if (typeof SistemaCisterna !== 'undefined') {
    console.error('‚ùå ERROR CR√çTICO: SistemaCisterna se carg√≥ en login!');
    console.error('‚ùå Forzando recarga limpia...');
    
    // Limpiar sessionStorage por seguridad
    sessionStorage.clear();
    
    // Redirigir a la ra√≠z con par√°metro para evitar cache
    setTimeout(() => {
        window.location.href = window.location.origin + '?nocache=' + Date.now();
    }, 1000);
}
</script>
</body>
</html>